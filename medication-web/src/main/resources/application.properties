spring.application.name=nll-light-web
server.port=8080

# Configure API base URL (can be overridden by env API_BASE_URL)
# Using direct connection to medication-api instead of Kong gateway
# since Kong routes are not yet configured for prescription endpoints
# Note: medication-api runs on port 8080 inside the container (8081 is the external mapped port)
api.base-url=${API_BASE_URL:http://medication-api:8080}

# Enable debug logging for OAuth2
logging.level.org.springframework.security=DEBUG
logging.level.org.springframework.security.oauth2=DEBUG
logging.level.org.springframework.web.client=DEBUG
logging.level.org.springframework.security.web=DEBUG

# OAuth2 / OIDC Configuration for Keycloak
spring.security.oauth2.client.registration.keycloak.client-id=medication-web
spring.security.oauth2.client.registration.keycloak.client-secret=web-app-secret
spring.security.oauth2.client.registration.keycloak.scope=openid,profile,email
spring.security.oauth2.client.registration.keycloak.authorization-grant-type=authorization_code
spring.security.oauth2.client.registration.keycloak.redirect-uri={baseUrl}/login/oauth2/code/{registrationId}
spring.security.oauth2.client.registration.keycloak.client-authentication-method=client_secret_post

# Keycloak Provider Configuration
# Browser-facing authorization endpoint uses localhost:8082 (accessible from user's browser)
spring.security.oauth2.client.provider.keycloak.authorization-uri=http://localhost:8082/auth/realms/nll-light/protocol/openid-connect/auth

# Container-to-container endpoints use internal Docker DNS (keycloak:8080)
spring.security.oauth2.client.provider.keycloak.token-uri=http://keycloak:8080/auth/realms/nll-light/protocol/openid-connect/token
# userinfo endpoint removed - we extract user info from ID token instead to avoid issuer mismatch
spring.security.oauth2.client.provider.keycloak.jwk-set-uri=http://keycloak:8080/auth/realms/nll-light/protocol/openid-connect/certs
spring.security.oauth2.client.provider.keycloak.user-name-attribute=preferred_username

# Note: issuer-uri is NOT set here because it would try to fetch .well-known/openid-configuration at startup
# from localhost:8082 which is not accessible from inside the container. Instead, we manually configure
# all required endpoints above. The issuer-uri for logout is constructed dynamically in SecurityConfig.
